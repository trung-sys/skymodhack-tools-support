<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nạp tiền - SKYMODHACK</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/themes.css">
    
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
    </style>
</head>

<body class="bg-[#1a0b2e] text-white min-h-screen flex flex-col">
    <!-- Include Header -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 mt-20">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold">Nạp tiền</h1>
            <div class="px-4 py-2 rounded-lg bg-[#2a1b3e] border border-pink-500/30">
                <span class="text-sm text-gray-400 mr-2">Số dư:</span>
                <span class="user-balance font-bold text-pink-500">0đ</span>
            </div>
        </div>

        <!-- Payment Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Left Column - Payment Form -->
            <div class="space-y-6">
                <form id="topup-form" class="bg-[#2a1b3e] rounded-xl p-6 border border-pink-500/30">
                    <!-- Payment Method Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-400 mb-2">Phương thức thanh toán</label>
                        <div class="grid grid-cols-2 gap-4">
                            <button type="button" data-payment-method="bank"
                                    class="px-4 py-3 rounded-lg bg-pink-500 text-white hover:bg-pink-600 transition-colors flex items-center justify-center space-x-2">
                                <i class="fas fa-university"></i>
                                <span>Ngân hàng</span>
                            </button>
                            <button type="button" data-payment-method="momo"
                                    class="px-4 py-3 rounded-lg border border-pink-500 text-pink-500 hover:bg-pink-500 hover:text-white transition-colors flex items-center justify-center space-x-2">
                                <i class="fas fa-wallet"></i>
                                <span>MoMo</span>
                            </button>
                        </div>
                        <input type="hidden" name="payment_method" value="bank">
                    </div>

                    <!-- Amount Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-400 mb-2">Số tiền nạp</label>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <button type="button" data-amount="50000"
                                    class="px-4 py-3 rounded-lg bg-pink-500 text-white hover:bg-pink-600 transition-colors">
                                50,000đ
                            </button>
                            <button type="button" data-amount="100000"
                                    class="px-4 py-3 rounded-lg border border-pink-500 text-pink-500 hover:bg-pink-500 hover:text-white transition-colors">
                                100,000đ
                            </button>
                            <button type="button" data-amount="200000"
                                    class="px-4 py-3 rounded-lg border border-pink-500 text-pink-500 hover:bg-pink-500 hover:text-white transition-colors">
                                200,000đ
                            </button>
                            <button type="button" data-amount="500000"
                                    class="px-4 py-3 rounded-lg border border-pink-500 text-pink-500 hover:bg-pink-500 hover:text-white transition-colors">
                                500,000đ
                            </button>
                            <button type="button" data-amount="1000000"
                                    class="px-4 py-3 rounded-lg border border-pink-500 text-pink-500 hover:bg-pink-500 hover:text-white transition-colors">
                                1,000,000đ
                            </button>
                            <button type="button" data-amount="custom"
                                    class="px-4 py-3 rounded-lg border border-pink-500 text-pink-500 hover:bg-pink-500 hover:text-white transition-colors">
                                Tùy chọn
                            </button>
                        </div>
                        <input type="number" id="custom-amount" name="amount"
                               class="w-full px-4 py-3 rounded-lg bg-[#1a0b2e] border border-pink-500/30 text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors"
                               placeholder="Nhập số tiền tùy chọn"
                               min="10000" step="10000" disabled>
                    </div>

                    <!-- Transaction ID -->
                    <div class="mb-6">
                        <label for="transaction_id" class="block text-sm font-medium text-gray-400 mb-2">Mã giao dịch</label>
                        <input type="text" id="transaction_id" name="transaction_id" required
                               class="w-full px-4 py-3 rounded-lg bg-[#1a0b2e] border border-pink-500/30 text-white placeholder-gray-500 focus:outline-none focus:border-pink-500 transition-colors"
                               placeholder="Nhập mã giao dịch">
                    </div>

                    <!-- Submit Button -->
                    <button type="submit"
                            class="w-full py-3 px-4 rounded-lg bg-pink-500 text-white font-medium hover:bg-pink-600 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 focus:ring-offset-[#1a0b2e]">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Gửi yêu cầu nạp tiền
                    </button>
                </form>
            </div>

            <!-- Right Column - Payment Info -->
            <div class="space-y-6">
                <!-- Bank Transfer Info -->
                <div id="bank-info" data-payment-info="bank" class="bg-[#2a1b3e] rounded-xl p-6 border border-pink-500/30">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-12 h-12 rounded-lg bg-[#1a0b2e] flex items-center justify-center">
                            <i class="fas fa-university text-2xl text-pink-500"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold">Chuyển khoản ngân hàng</h3>
                            <p class="text-sm text-gray-400">Chuyển khoản qua tài khoản ngân hàng</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <!-- Bank info will be loaded dynamically -->
                        <div class="animate-pulse">
                            <div class="h-4 bg-[#1a0b2e] rounded w-3/4 mb-2"></div>
                            <div class="h-4 bg-[#1a0b2e] rounded w-1/2"></div>
                        </div>
                    </div>
                </div>

                <!-- MoMo Info -->
                <div id="momo-info" data-payment-info="momo" class="bg-[#2a1b3e] rounded-xl p-6 border border-pink-500/30 hidden">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-12 h-12 rounded-lg bg-[#1a0b2e] flex items-center justify-center">
                            <i class="fas fa-wallet text-2xl text-pink-500"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold">Ví MoMo</h3>
                            <p class="text-sm text-gray-400">Chuyển tiền qua ví điện tử MoMo</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <!-- MoMo info will be loaded dynamically -->
                        <div class="animate-pulse">
                            <div class="h-4 bg-[#1a0b2e] rounded w-3/4 mb-2"></div>
                            <div class="h-4 bg-[#1a0b2e] rounded w-1/2"></div>
                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="bg-[#2a1b3e] rounded-xl p-6 border border-pink-500/30">
                    <h3 class="text-lg font-semibold mb-4">Hướng dẫn nạp tiền</h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-4">
                            <div class="w-6 h-6 rounded-full bg-pink-500 flex items-center justify-center flex-shrink-0">
                                <span class="text-sm">1</span>
                            </div>
                            <p class="text-sm text-gray-400">
                                Chọn phương thức thanh toán và số tiền muốn nạp
                            </p>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="w-6 h-6 rounded-full bg-pink-500 flex items-center justify-center flex-shrink-0">
                                <span class="text-sm">2</span>
                            </div>
                            <p class="text-sm text-gray-400">
                                Chuyển tiền theo thông tin tài khoản được cung cấp
                            </p>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="w-6 h-6 rounded-full bg-pink-500 flex items-center justify-center flex-shrink-0">
                                <span class="text-sm">3</span>
                            </div>
                            <p class="text-sm text-gray-400">
                                Điền mã giao dịch vào form và gửi yêu cầu nạp tiền
                            </p>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="w-6 h-6 rounded-full bg-pink-500 flex items-center justify-center flex-shrink-0">
                                <span class="text-sm">4</span>
                            </div>
                            <p class="text-sm text-gray-400">
                                Đợi hệ thống xác nhận và cộng tiền vào tài khoản (thường trong vòng 5 phút)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Include Footer -->
    <div id="footer-container"></div>

    <!-- Include Auth Modals -->
    <div id="auth-modals-container"></div>

    <!-- Scripts -->
    <script type="module">
        import auth from './js/auth.js';
        import payment from './js/payment.js';
        
        // Load components
        fetch('components/header.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('header-container').innerHTML = html;
            });

        fetch('components/footer.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('footer-container').innerHTML = html;
            });

        fetch('components/auth-modals.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('auth-modals-container').innerHTML = html;
            });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            // Check authentication
            if (!auth.isAuthenticated) {
                window.location.href = 'index.html';
                return;
            }

            // Update user balance
            const balanceElement = document.querySelector('.user-balance');
            if (balanceElement) {
                balanceElement.textContent = auth.userBalance.toLocaleString('vi-VN') + 'đ';
            }

            // Set up payment method selection
            const methodButtons = document.querySelectorAll('[data-payment-method]');
            methodButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const method = button.getAttribute('data-payment-method');
                    selectPaymentMethod(method);
                });
            });

            // Set up amount selection
            const amountButtons = document.querySelectorAll('[data-amount]');
            amountButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const amount = button.getAttribute('data-amount');
                    selectAmount(amount);
                });
            });

            // Handle custom amount input
            const customAmount = document.getElementById('custom-amount');
            customAmount?.addEventListener('input', () => {
                const value = parseInt(customAmount.value);
                if (value < 10000) {
                    customAmount.value = 10000;
                }
            });

            // Handle form submission
            const topupForm = document.getElementById('topup-form');
            topupForm?.addEventListener('submit', (e) => {
                e.preventDefault();
                payment.processTopup(new FormData(topupForm));
            });
        });

        function selectPaymentMethod(method) {
            // Update UI
            const methodButtons = document.querySelectorAll('[data-payment-method]');
            methodButtons.forEach(button => {
                const isSelected = button.getAttribute('data-payment-method') === method;
                button.classList.toggle('bg-pink-500', isSelected);
                button.classList.toggle('text-white', isSelected);
                button.classList.toggle('border-pink-500', !isSelected);
                button.classList.toggle('text-pink-500', !isSelected);
            });

            // Show corresponding info section
            const infoPanels = document.querySelectorAll('[data-payment-info]');
            infoPanels.forEach(panel => {
                panel.classList.toggle('hidden', panel.getAttribute('data-payment-info') !== method);
            });

            // Update form value
            const methodInput = document.querySelector('input[name="payment_method"]');
            if (methodInput) {
                methodInput.value = method;
            }
        }

        function selectAmount(amount) {
            // Update UI
            const amountButtons = document.querySelectorAll('[data-amount]');
            amountButtons.forEach(button => {
                const isSelected = button.getAttribute('data-amount') === amount;
                button.classList.toggle('bg-pink-500', isSelected);
                button.classList.toggle('text-white', isSelected);
                button.classList.toggle('border-pink-500', !isSelected);
                button.classList.toggle('text-pink-500', !isSelected);
            });

            // Handle custom amount input
            const customAmount = document.getElementById('custom-amount');
            if (customAmount) {
                customAmount.value = amount === 'custom' ? '' : amount;
                customAmount.disabled = amount !== 'custom';
                if (amount === 'custom') {
                    customAmount.focus();
                }
            }

            // Update form value
            const amountInput = document.querySelector('input[name="amount"]');
            if (amountInput && amount !== 'custom') {
                amountInput.value = amount;
            }
        }
    </script>
</body>
</html>
